# Multi-Commit Plan
Generated: 2025-08-13 19:00
Repository: /Users/eduardokolomajr/dev/agent-os
Current Branch: peer-agent-pattern

## Branch Strategy
This plan organizes uncommitted changes across four branches:

1. **peer-agent-pattern** (current): Core PEER pattern implementation and refinements
2. **claude-code-sandbox-security** (new): Complete sandbox security feature with test reorganization
3. **meta-agent-feature** (new): Meta agent implementation (separate from PEER work)
4. **main** (merge targets): Setup improvements and product documentation

## Commit Groups

### Branch: peer-agent-pattern
Base: main

#### Commit 1: 🧹 Clean up PEER agent backup files
**Files:**
- claude-code/agents/peer-executor.md.bak (DELETE)
- claude-code/agents/peer-express.md.bak (DELETE)
- claude-code/agents/peer-planner.md.bak (DELETE)
- claude-code/agents/peer-review.md.bak (DELETE)
- instructions/core/peer.md.bak (DELETE)

**Rationale:** Remove backup files that are no longer needed after PEER agent transformations.

#### Commit 2: 📋 Update PEER agents declarative transformation spec
**Files:**
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/spec.md
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/tasks.md

**Rationale:** Core spec and task updates reflecting current implementation progress and requirements.

#### Commit 3: 📝 Add PEER transformation sub-specifications
**Files:**
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/architectural-corrections.md
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/cycle-number-context.md
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/file-pattern-consistency.md
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/json-implementation-guide.md
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/refine-spec-integration.md
- .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/wrapper-script-enhancement.md

**Rationale:** Detailed sub-specifications that provide implementation guidance for PEER transformation work.

#### Commit 4: 🏗️ Implement unified state schema for PEER pattern
**Files:**
- instructions/meta/unified_state_schema.md

**Rationale:** Central schema definition that standardizes state management across all PEER components.

#### Commit 5: 🔧 Update NATS KV operations for PEER pattern
**Files:**
- instructions/meta/nats-kv-operations.md

**Rationale:** Standardized NATS operations supporting unified state management.

#### Commit 6: ⚡ Transform PEER agents to declarative patterns
**Files:**
- claude-code/agents/peer-executor.md
- claude-code/agents/peer-express.md
- claude-code/agents/peer-planner.md
- claude-code/agents/peer-review.md

**Rationale:** Core transformation of all four PEER agents from script-based to declarative implementations.

#### Commit 7: 🎯 Update PEER command and instruction integration
**Files:**
- commands/peer.md
- instructions/core/peer.md

**Rationale:** Main PEER command and instruction updates to support new declarative agent implementations.

#### Commit 8: 🔧 Enhance PEER state management scripts
**Files:**
- scripts/peer/update-state.sh
- scripts/peer/test-hybrid-wrapper.sh

**Rationale:** Supporting script improvements for unified state management and PEER testing functionality.

#### Commit 9: 📖 Add PEER adaptive orchestration strategy
**Files:**
- .agent-os/peer-adaptive-orchestration-strategy.md

**Rationale:** Strategic documentation for PEER pattern orchestration improvements.

#### Commit 10: 📋 Add PEER git commit specification
**Files:**
- .agent-os/specs/2025-08-13-peer-git-commit-plan-execution/spec.md
- .agent-os/specs/2025-08-13-peer-git-commit-plan-execution/spec-lite.md
- .agent-os/specs/2025-08-13-peer-git-commit-plan-execution/tasks.md
- .agent-os/specs/2025-08-13-peer-git-commit-plan-execution/sub-specs/technical-spec.md

**Rationale:** Complete specification for PEER-based git commit planning and execution functionality.

#### Commit 11: 🔄 Update instruction file creator constraints
**Files:**
- instructions/core/refine-spec.md

**Rationale:** Add file-creator constraints to refine-spec instruction for better execution control.

### Branch: claude-code-sandbox-security
Base: main

#### Commit 1: 📋 Add Claude Code sandbox security specification
**Files:**
- .agent-os/specs/2025-08-11-claude-code-sandbox-security/

**Rationale:** Complete specification for sandbox security improvements implementing principle of least privilege.

#### Commit 2: 🏗️ Reorganize test files into dedicated directory
**Files:**
- tests/test-audit-logging.sh
- tests/test-env-vars.sh
- tests/test-executable-permissions.sh
- tests/test-launcher.sh
- tests/test-network-permissions.sh
- tests/test-read-restrictions.sh
- tests/test-sandbox-deny-rules.sh
- tests/test-write-restrictions.sh

**Rationale:** Organize all sandbox testing files into a dedicated tests directory for better project structure.

#### Commit 3: 🔒 Implement Claude Code sandbox security configuration
**Files:**
- claude-code-sandbox.sb
- claude-code-sandbox-launcher.sh
- deploy-claude-code-sandbox.sh

**Rationale:** Core sandbox security implementation files with launcher and deployment scripts.

#### Commit 4: 🔍 Add sandbox audit and monitoring tools
**Files:**
- sandbox-audit-logger.sh
- sandbox-audit-rotate.sh

**Rationale:** Audit logging and rotation tools for monitoring sandbox security compliance.

#### Commit 5: 📚 Add sandbox security documentation
**Files:**
- docs/claude-code-sandbox-examples.md
- docs/claude-code-sandbox-future-config.md
- docs/claude-code-sandbox-launcher-usage.md
- docs/claude-code-sandbox-parameters.md
- docs/claude-code-sandbox-security-boundaries.md
- docs/claude-code-sandbox-troubleshooting.md

**Rationale:** Comprehensive documentation for sandbox security configuration, usage, and troubleshooting.

#### Commit 6: 🧪 Add test execution script
**Files:**
- run-all-tests.sh

**Rationale:** Master script to execute all sandbox security tests.

### Branch: meta-agent-feature
Base: main

#### Commit 1: 🤖 Add meta-agent implementation
**Files:**
- claude-code/agents/meta-agent.md

**Rationale:** New meta-agent capability separate from PEER pattern work.

### Branch: product-setup-improvements (to merge to main)
Base: main

#### Commit 1: 📦 Add Agent OS product documentation
**Files:**
- .agent-os/product/decisions.md
- .agent-os/product/messaging-templates.md
- .agent-os/product/mission-lite.md
- .agent-os/product/mission.md
- .agent-os/product/roadmap.md
- .agent-os/product/tech-stack.md

**Rationale:** Complete Agent OS product documentation setup following Agent OS framework patterns.

#### Commit 2: ⚙️ Update setup and configuration scripts
**Files:**
- setup-claude-code.sh
- setup.sh

**Rationale:** Improvements to setup scripts for better installation and configuration experience.

#### Commit 3: 📝 Add JSON creation standards
**Files:**
- instructions/meta/json-creation-standards.md

**Rationale:** Standardized JSON creation guidelines for consistent data handling.

#### Commit 4: 🛠️ Add git commit meta instructions
**Files:**
- instructions/meta/commit-plan-schema.md
- instructions/meta/commit-plan-validation.md
- instructions/meta/git-commit-state-management.md
- instructions/meta/git-error-recovery.md
- instructions/meta/multi-branch-execution.md
- instructions/meta/user-interaction-workflows.md
- instructions/core/git-commit.md

**Rationale:** Comprehensive git commit meta instructions for enhanced commit planning and execution workflows.

## Execution Commands

### Step 1: Complete PEER Pattern Work (current branch)
```bash
# Already on peer-agent-pattern branch

# Commit 1: Cleanup
git add claude-code/agents/peer-executor.md.bak
git add claude-code/agents/peer-express.md.bak  
git add claude-code/agents/peer-planner.md.bak
git add claude-code/agents/peer-review.md.bak
git add instructions/core/peer.md.bak
git rm claude-code/agents/peer-executor.md.bak
git rm claude-code/agents/peer-express.md.bak
git rm claude-code/agents/peer-planner.md.bak
git rm claude-code/agents/peer-review.md.bak
git rm instructions/core/peer.md.bak
git commit -m "🧹 Clean up PEER agent backup files

Remove backup files that are no longer needed after PEER agent transformations."

# Commit 2: Spec updates
git add .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/spec.md
git add .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/tasks.md
git commit -m "📋 Update PEER agents declarative transformation spec

Core spec and task updates reflecting current implementation progress and requirements."

# Commit 3: Sub-specs
git add .agent-os/specs/2025-08-05-peer-agents-declarative-transformation/sub-specs/
git commit -m "📝 Add PEER transformation sub-specifications

Detailed sub-specifications that provide implementation guidance for PEER transformation work."

# Commit 4: Unified state schema
git add instructions/meta/unified_state_schema.md
git commit -m "🏗️ Implement unified state schema for PEER pattern

Central schema definition that standardizes state management across all PEER components."

# Commit 5: NATS operations
git add instructions/meta/nats-kv-operations.md
git commit -m "🔧 Update NATS KV operations for PEER pattern

Standardized NATS operations supporting unified state management."

# Commit 6: Agent transformations
git add claude-code/agents/peer-executor.md
git add claude-code/agents/peer-express.md
git add claude-code/agents/peer-planner.md
git add claude-code/agents/peer-review.md
git commit -m "⚡ Transform PEER agents to declarative patterns

Core transformation of all four PEER agents from script-based to declarative implementations."

# Commit 7: Commands and instructions
git add commands/peer.md
git add instructions/core/peer.md
git commit -m "🎯 Update PEER command and instruction integration

Main PEER command and instruction updates to support new declarative agent implementations."

# Commit 8: Scripts
git add scripts/peer/update-state.sh
git add scripts/peer/test-hybrid-wrapper.sh
git commit -m "🔧 Enhance PEER state management scripts

Supporting script improvements for unified state management and PEER testing functionality."

# Commit 9: Strategy docs
git add .agent-os/peer-adaptive-orchestration-strategy.md
git commit -m "📖 Add PEER adaptive orchestration strategy

Strategic documentation for PEER pattern orchestration improvements."

# Commit 10: PEER git commit spec
git add .agent-os/specs/2025-08-13-peer-git-commit-plan-execution/
git commit -m "📋 Add PEER git commit specification

Complete specification for PEER-based git commit planning and execution functionality."

# Commit 11: Refine spec updates
git add instructions/core/refine-spec.md
git commit -m "🔄 Update instruction file creator constraints

Add file-creator constraints to refine-spec instruction for better execution control."
```

### Step 2: Create Sandbox Security Branch
```bash
git checkout main
git checkout -b claude-code-sandbox-security

# Commit 1: Spec
git add .agent-os/specs/2025-08-11-claude-code-sandbox-security/
git commit -m "📋 Add Claude Code sandbox security specification

Complete specification for sandbox security improvements implementing principle of least privilege."

# Commit 2: Test reorganization
git add tests/
git commit -m "🏗️ Reorganize test files into dedicated directory

Organize all sandbox testing files into a dedicated tests directory for better project structure."

# Commit 3: Core implementation
git add claude-code-sandbox.sb
git add claude-code-sandbox-launcher.sh
git add deploy-claude-code-sandbox.sh
git commit -m "🔒 Implement Claude Code sandbox security configuration

Core sandbox security implementation files with launcher and deployment scripts."

# Commit 4: Audit tools
git add sandbox-audit-logger.sh
git add sandbox-audit-rotate.sh
git commit -m "🔍 Add sandbox audit and monitoring tools

Audit logging and rotation tools for monitoring sandbox security compliance."

# Commit 5: Documentation
git add docs/
git commit -m "📚 Add sandbox security documentation

Comprehensive documentation for sandbox security configuration, usage, and troubleshooting."

# Commit 6: Test runner
git add run-all-tests.sh
git commit -m "🧪 Add test execution script

Master script to execute all sandbox security tests."
```

### Step 3: Create Meta Agent Branch  
```bash
git checkout main
git checkout -b meta-agent-feature

git add claude-code/agents/meta-agent.md
git commit -m "🤖 Add meta-agent implementation

New meta-agent capability separate from PEER pattern work."
```

### Step 4: Create Product Setup Branch
```bash
git checkout main
git checkout -b product-setup-improvements

# Commit 1: Product docs
git add .agent-os/product/
git commit -m "📦 Add Agent OS product documentation

Complete Agent OS product documentation setup following Agent OS framework patterns."

# Commit 2: Setup scripts
git add setup-claude-code.sh
git add setup.sh
git commit -m "⚙️ Update setup and configuration scripts

Improvements to setup scripts for better installation and configuration experience."

# Commit 3: JSON standards
git add instructions/meta/json-creation-standards.md
git commit -m "📝 Add JSON creation standards

Standardized JSON creation guidelines for consistent data handling."

# Commit 4: Git commit meta instructions
git add instructions/meta/commit-plan-schema.md
git add instructions/meta/commit-plan-validation.md
git add instructions/meta/git-commit-state-management.md
git add instructions/meta/git-error-recovery.md
git add instructions/meta/multi-branch-execution.md
git add instructions/meta/user-interaction-workflows.md
git add instructions/core/git-commit.md
git commit -m "🛠️ Add git commit meta instructions

Comprehensive git commit meta instructions for enhanced commit planning and execution workflows."
```

## Potential Conflicts
- **.gitignore**: Modified on peer-agent-pattern branch, may need to be handled carefully when merging
- **.claude/settings.local.json**: Modified on peer-agent-pattern branch  
- Setup scripts are modified on peer-agent-pattern but also being moved to product-setup-improvements

## Branch Merge Order
1. Merge `product-setup-improvements` to `main` first (foundational)
2. Merge `meta-agent-feature` to `main` (independent feature)  
3. Merge `claude-code-sandbox-security` to `main` (independent feature)
4. Merge `peer-agent-pattern` to `main` last (most complex, may have conflicts)

## Files Excluded from Plan
- **.claude/agents/multi-commit-planner.md**: Explicitly excluded as instructed
- **.nvimlog**: Temporary editor file, should not be committed
- **bash-commands-from-output.txt**: Temporary file, should not be committed  
- **other-commands-from-output.txt**: Temporary file, should not be committed
- **output-execute-tasks-test.txt**: Temporary file, should not be committed
- **peer-cycle-4-base-commands.txt**: Temporary file, should not be committed
- **peer-cycle-4-commands-summary.md**: Temporary file, should not be committed

## Notes
- The test files in the `tests/` directory are all sandbox-related tests that belong with the sandbox security feature
- PEER pattern work is substantial and represents a major architectural improvement
- Sandbox security is a complete independent feature with comprehensive testing and documentation
- Product documentation follows Agent OS standards and provides foundation for project organization
- All branches can be developed and tested independently
- Git config files (.gitignore, .claude/settings.local.json) are currently on peer-agent-pattern but may need resolution during merges